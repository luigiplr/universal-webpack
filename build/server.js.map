{"version":3,"sources":["../source/server.js"],"names":["server","webpack_configuration","settings","context","Error","server_bundle_path","resolve","output","then","chunk_info_json_file_path","chunk_info_filename","additional","chunks","process","env","NODE_ENV","require","cache","starter","default","stringified_starter","String","inspect","catch","error","console","log","stack","exit"],"mappings":";;;;;;;;;;kBAOwBA,M;;AAPxB;;;;AACA;;;;AACA;;;;AAEA;;;;AACA;;;;AAEe,SAASA,MAAT,CAAgBC,qBAAhB,EAAuCC,QAAvC,EACf;AACC,KAAI,CAACD,sBAAsBE,OAA3B,EACA;AACC,QAAM,IAAIC,KAAJ,kEAAN;AACA;;AAED;AACA;AACA,KAAMC,qBAAqB,eAAKC,OAAL,CAAaL,sBAAsBE,OAAnC,EAA4CD,SAASF,MAAT,CAAgBO,MAA5D,CAA3B;;AAEA;AACA,QAAO,2BAAcF,kBAAd,EAAkCG,IAAlC,CAAuC,YAC9C;AACC,MAAMC,4BAA4B,kCAAqBR,qBAArB,EAA4CC,SAASQ,mBAArD,CAAlC;;AAEA;AACA,MAAMC,aACN;AACCC,WAAQ,kBACR;AACC;AACA,QAAIC,QAAQC,GAAR,CAAYC,QAAZ,KAAyB,aAA7B,EACA;AACC,YAAOC,QAAQC,KAAR,CAAcR,yBAAd,CAAP;AACA;;AAED,WAAOO,QAAQP,yBAAR,CAAP;AACA;AAVF,GADA;;AAcA;AACA;;AAEA,MAAMS,UAAUF,QAAQX,kBAAR,CAAhB;;AAEA;;AAEA,MAAI,OAAOa,OAAP,KAAmB,UAAvB,EACA;AACC,UAAOA,QAAQP,UAAR,CAAP;AACA;;AAED,MAAI,OAAOO,QAAQC,OAAf,KAA2B,UAA/B,EACA;AACC,UAAOD,QAAQC,OAAR,CAAgBR,UAAhB,CAAP;AACA;;AAED,MAAIS,sBAAsBC,OAAOH,OAAP,CAA1B;AACA,MAAIE,wBAAwB,iBAA5B,EACA;AACCA,yBAAsB,yBAAeF,OAAf,EAAwB,IAAxB,EAA8B,CAA9B,CAAtB;AACA;;AAED,QAAM,IAAId,KAAJ,CAAU,mFACR,eAAKkB,OAAL,CAAaJ,OAAb,CADQ,CAAV,CAAN;AAEA,EA5CM,EA6CNK,KA7CM,CA6CA,UAASC,KAAT,EACP;AACC;AACAC,UAAQC,GAAR,CAAY,iBAAZ;;AAEA;AACAD,UAAQD,KAAR,SAAmBA,MAAMG,KAAN,IAAeH,KAAlC;;AAEA;AACAC,UAAQC,GAAR,CAAY,kBAAZ;;AAEA;AACAb,UAAQe,IAAR,CAAa,CAAb;AACA,EA1DM,CAAP;AA2DA","file":"server.js","sourcesContent":["import path from 'path'\nimport fs from 'fs'\nimport util from 'util'\n\nimport wait_for_file from './wait for file'\nimport { chunk_info_file_path } from './chunks'\n\nexport default function server(webpack_configuration, settings)\n{\n\tif (!webpack_configuration.context)\n\t{\n\t\tthrow new Error(`You must set \"context\" parameter in your Webpack configuration`)\n\t}\n\n\t// Path to `build/server.js`\n\t// (built by Webpack)\n\tconst server_bundle_path = path.resolve(webpack_configuration.context, settings.server.output)\n\n\t// waits for the first Webpack server-side build to finish and produce `webpage_rendering_server.js`\n\treturn wait_for_file(server_bundle_path).then(function()\n\t{\n\t\tconst chunk_info_json_file_path = chunk_info_file_path(webpack_configuration, settings.chunk_info_filename)\n\n\t\t// Will be passed to the server code\n\t\tconst additional =\n\t\t{\n\t\t\tchunks: () =>\n\t\t\t{\n\t\t\t\t// clear Webpack require() cache for hot reload in development mode\n\t\t\t\tif (process.env.NODE_ENV === 'development')\n\t\t\t\t{\n\t\t\t\t\tdelete require.cache[chunk_info_json_file_path]\n\t\t\t\t}\n\n\t\t\t\treturn require(chunk_info_json_file_path)\n\t\t\t}\n\t\t}\n\n\t\t// Start webpage rendering server\n\t\t// (this module will be compiled by Webpack server-side build from './source/server.js')\n\n\t\tconst starter = require(server_bundle_path)\n\n\t\t// Fixing Babel `module.exports.default` issues\n\n\t\tif (typeof starter === 'function')\n\t\t{\n\t\t\treturn starter(additional)\n\t\t}\n\n\t\tif (typeof starter.default === 'function')\n\t\t{\n\t\t\treturn starter.default(additional)\n\t\t}\n\n\t\tlet stringified_starter = String(starter)\n\t\tif (stringified_starter === '[object Object]')\n\t\t{\n\t\t\tstringified_starter = JSON.stringify(starter, null, 2)\n\t\t}\n\n\t\tthrow new Error(`[universal-webpack] Your server source file must export a function. ` +\n\t\t\t`Got ${util.inspect(starter)}`)\n\t})\n\t.catch(function(error)\n\t{\n\t\t// bright red color\n\t\tconsole.log(\"\\x1b[1m\\x1b[31m\")\n\n\t\t// Output the error stack trace\n\t\tconsole.error(`\\n${error.stack || error}`)\n\n\t\t// reset color and brightness\n\t\tconsole.log('\\x1b[39m\\x1b[22m')\n\n\t\t// exit with non-zero exit code (indicating that an error happened)\n\t\tprocess.exit(1)\n\t})\n}\n"]}