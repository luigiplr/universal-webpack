{"version":3,"sources":["../source/client configuration.js"],"names":["client_configuration","webpack_configuration","settings","options","configuration","plugins","push","silent","chunk_info_filename","development","css_bundle","css_bundle_filename","extract_css","extract_text_plugin_instance","allChunks","loader","style_loader","loaders","filter","before_style_loader","slice","indexOf","after_style_loader","extract_text_plugin_extract","remove","style_loader_and_before","filename","plugin","error","message","fallbackLoader","result","extract"],"mappings":";;;;;;;;;;;;;;kBAMwBA,oB;;AANxB;;;;AAEA;;;;AACA;;AACA;;;;AAEe,SAASA,oBAAT,CAA8BC,qBAA9B,EAAqDC,QAArD,EACf;AAAA,KAD8EC,OAC9E,uEADwF,EACxF;;AACC,KAAMC,gBAAgB,oBAAMH,qBAAN,CAAtB;;AAEAG,eAAcC,OAAd,GAAwBD,cAAcC,OAAd,IAAyB,EAAjD;;AAEAD,eAAcC,OAAd,CAAsBC,IAAtB;AAEC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BAAkB,oBAAMF,aAAN,CAAlB,EAAwC,EAAEG,QAAQL,SAASK,MAAnB,EAA2BC,qBAAqBN,SAASM,mBAAzD,EAAxC,CAZD;;AAeA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAIL,QAAQM,WAAR,IAAuBN,QAAQO,UAAnC,EACA;AACC,MAAIC,sBAAsB,0BAA1B;;AAEA,MAAI,OAAOR,QAAQO,UAAf,KAA8B,QAAlC,EACA;AACCC,yBAAsBR,QAAQO,UAA9B;AACA;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAME,cAAcC,6BAA6BF,mBAA7B,EAAkD,EAAEG,WAAW,IAAb,EAAlD,CAApB;;AAEA;AACA;AAxBD;AAAA;AAAA;;AAAA;AAyBC,mDAAmB,iCAAmBV,aAAnB,CAAnB,4GACA;AAAA,QADSW,MACT;;AACC,oCAAkBA,MAAlB;;AAEA,QAAMC,eAAeD,OAAOE,OAAP,CAAeC,MAAf,2BAAuC,CAAvC,CAArB;;AAEA,QAAMC,sBAAsBJ,OAAOE,OAAP,CAAeG,KAAf,CAAqB,CAArB,EAAwBL,OAAOE,OAAP,CAAeI,OAAf,CAAuBL,YAAvB,CAAxB,CAA5B;AACA,QAAMM,qBAAsBP,OAAOE,OAAP,CAAeG,KAAf,CAAqBL,OAAOE,OAAP,CAAeI,OAAf,CAAuBL,YAAvB,IAAuC,CAA5D,CAA5B;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAD,WAAOA,MAAP,GAAgB,kBAAkBQ,4BAA4BX,WAA5B,EAAyCO,mBAAzC,EAA8DG,kBAA9D,EAAkF,EAAEE,QAAQ,KAAV,EAAlF,CAAlC;AACA,WAAOT,OAAOE,OAAd;AACA;;AAED;AACA;AACA;AAlDD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAmDCb,gBAAcC,OAAd,CAAsBC,IAAtB,CAA2BM,WAA3B;AACA;;AAED;AACA;AACA;AACA,KAAIT,QAAQM,WAAR,KAAwB,KAAxB,IAAiCN,QAAQO,UAAR,KAAuB,KAA5D,EACA;AACC,MAAIC,uBAAsB,0BAA1B;;AAEA,MAAI,OAAOR,QAAQO,UAAf,KAA8B,QAAlC,EACA;AACCC,0BAAsBR,QAAQO,UAA9B;AACA;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAME,eAAcC,6BAA6BF,oBAA7B,EAAkD,EAAEG,WAAW,IAAb,EAAlD,CAApB;;AAEA;AACA;AAtBD;AAAA;AAAA;;AAAA;AAuBC,oDAAmB,iCAAmBV,aAAnB,CAAnB,iHACA;AAAA,QADSW,OACT;;AACC,oCAAkBA,OAAlB;;AAEA,QAAMC,gBAAeD,QAAOE,OAAP,CAAeC,MAAf,2BAAuC,CAAvC,CAArB;;AAEA,QAAMO,0BAA0BV,QAAOE,OAAP,CAAeG,KAAf,CAAqB,CAArB,EAAwBL,QAAOE,OAAP,CAAeI,OAAf,CAAuBL,aAAvB,IAAuC,CAA/D,CAAhC;AACA,QAAMM,sBAA0BP,QAAOE,OAAP,CAAeG,KAAf,CAAqBL,QAAOE,OAAP,CAAeI,OAAf,CAAuBL,aAAvB,IAAuC,CAA5D,CAAhC;;AAEA;AACA;AACA;AACA;AACAD,YAAOA,MAAP,GAAgBQ,4BAA4BX,YAA5B,EAAyCa,uBAAzC,EAAkEH,mBAAlE,CAAhB;AACA,WAAOP,QAAOE,OAAd;AACA;;AAED;AACA;AACA;AA1CD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AA2CCb,gBAAcC,OAAd,CAAsBC,IAAtB,CAA2BM,YAA3B;AACA;;AAED;AACA,QAAOR,aAAP;AACA;;AAED;AACA,SAASS,4BAAT,CAAsCa,QAAtC,EACA;AAAA,KADgDvB,OAChD,uEAD0D,EAC1D;;AACC,KAAIwB,eAAJ;;AAEA,KACA;AACCA,WAAS,uCAAwBD,QAAxB,EAAkCvB,OAAlC,CAAT;AACA,EAHD,CAIA,OAAOyB,KAAP,EACA;AACC,MAAI,0BAAYA,MAAMC,OAAlB,EAA2B,sEAA3B,CAAJ,EACA;AACCF,YAAS,kEAA6BxB,OAA7B,IAAsCuB,kBAAtC,IAAT;AACA,GAHD,MAKA;AACC,SAAME,KAAN;AACA;AACD;;AAED,QAAOD,MAAP;AACA;;AAED;AACA,SAASJ,2BAAT,CAAqCI,MAArC,EAA6CG,cAA7C,EAA6Df,MAA7D,EACA;AAAA,KADqEZ,OACrE,uEAD+E,EAC/E;;AACC,KAAI4B,eAAJ;;AAEA,KACA;AACCA,WAASJ,OAAOK,OAAP,CAAeF,cAAf,EAA+Bf,MAA/B,EAAuCZ,OAAvC,CAAT;AACA,EAHD,CAIA,OAAOyB,KAAP,EACA;AACC,MAAI,0BAAYA,MAAMC,OAAlB,EAA2B,4DAA3B,CAAJ,EACA;AACCE,YAASJ,OAAOK,OAAP,4BAAoB7B,OAApB,IAA6B2B,8BAA7B,EAA6Cf,cAA7C,IAAT;AACA,GAHD,MAKA;AACC,SAAMa,KAAN;AACA;AACD;;AAED,QAAOG,MAAP;AACA","file":"client configuration.js","sourcesContent":["import extract_text_plugin from 'extract-text-webpack-plugin'\r\n\r\nimport chunks_plugin from './chunks plugin'\r\nimport { clone, starts_with } from './helpers'\r\nimport { find_style_loaders, is_style_loader, normalize_loaders } from './loaders'\r\n\r\nexport default function client_configuration(webpack_configuration, settings, options = {})\r\n{\r\n\tconst configuration = clone(webpack_configuration)\r\n\r\n\tconfiguration.plugins = configuration.plugins || []\r\n\r\n\tconfiguration.plugins.push\r\n\t(\r\n\t\t// Add chunk filename info plugin\r\n\t\t//\r\n\t\t// Writes client-side build chunks filename info\r\n\t\t// for later use inside server-side rendering code\r\n\t\t// (`<script src=.../>` and `<link rel=\"style\" href=.../>` tags)\r\n\t\t//\r\n\t\t// Cloning Webpack configuration here\r\n\t\t// because `webpack-dev-server` seems to alter it\r\n\t\t// by changing the already predefined `.output.path`.\r\n\t\t//\r\n\t\tnew chunks_plugin(clone(configuration), { silent: settings.silent, chunk_info_filename: settings.chunk_info_filename })\r\n\t)\r\n\r\n\t// Not sure about the name yet\r\n\t// // Normalize legacy options\r\n\t// if (options.css_bundle)\r\n\t// {\r\n\t// \tconsole.warn(\"`css_bundle` option is now called `extract_styles`\")\r\n\t// \toptions.extract_styles = options.css_bundle\r\n\t// \tdelete options.css_bundle\r\n\t// }\r\n\r\n\t// If it's a client-side development webpack build,\r\n\t// and CSS bundle extraction is enabled,\r\n\t// then extract all CSS styles into a file.\r\n\t// (without removing them from the code)\r\n\tif (options.development && options.css_bundle)\r\n\t{\r\n\t\tlet css_bundle_filename = '[name]-[contenthash].css'\r\n\r\n\t\tif (typeof options.css_bundle === 'string')\r\n\t\t{\r\n\t\t\tcss_bundle_filename = options.css_bundle\r\n\t\t}\r\n\r\n\t\t// Extract styles into a file\r\n\t\t// (without removing them from the code in this case).\r\n\t\t//\r\n\t\t// It copies contents of each `require(\"style.css\")`\r\n\t\t// into one big CSS file on disk\r\n\t\t// which will be later read on the server-side\r\n\t\t// and inserted into `<head><style></style></head>`,\r\n\t\t// so that in development mode there's no\r\n\t\t// \"flash of unstyled content\" on page reload.\r\n\t\t//\r\n\t\t// \"allChunks: true\" option means that the styles from all chunks\r\n\t\t// (think \"entry points\") will be extracted into a single big CSS file.\r\n\t\t//\r\n\t\tconst extract_css = extract_text_plugin_instance(css_bundle_filename, { allChunks: true })\r\n\r\n\t\t// Find module loaders with `style-loader`,\r\n\t\t// and set those module loaders to `extract-text-webpack-plugin` loader\r\n\t\tfor (let loader of find_style_loaders(configuration))\r\n\t\t{\r\n\t\t\tnormalize_loaders(loader)\r\n\r\n\t\t\tconst style_loader = loader.loaders.filter(is_style_loader)[0]\r\n\r\n\t\t\tconst before_style_loader = loader.loaders.slice(0, loader.loaders.indexOf(style_loader))\r\n\t\t\tconst after_style_loader  = loader.loaders.slice(loader.loaders.indexOf(style_loader) + 1)\r\n\r\n\t\t\t// The first argument to the .extract() function is the name of the loader\r\n\t\t\t// (\"style-loader\" in this case) to be applied to non-top-level-chunks in case of \"allChunks: false\" option.\r\n\t\t\t// since in this configuration \"allChunks: true\" option is used, this first argument is irrelevant.\r\n\t\t\t//\r\n\t\t\t// `remove: false` ensures that the styles being extracted\r\n\t\t\t// aren't erased from the chunk javascript file.\r\n\t\t\t//\r\n\t\t\t// I'm also prepending another `style-loader` here\r\n\t\t\t// to re-enable adding these styles to the <head/> of the page on-the-fly.\r\n\t\t\t//\r\n\t\t\tloader.loader = 'style-loader!' + extract_text_plugin_extract(extract_css, before_style_loader, after_style_loader, { remove: false })\r\n\t\t\tdelete loader.loaders\r\n\t\t}\r\n\r\n\t\t// Add the `extract-text-webpack-plugin` to the list of plugins.\r\n\t\t// It will extract all CSS into a file\r\n\t\t// (without removing it from the code in this case)\r\n\t\tconfiguration.plugins.push(extract_css)\r\n\t}\r\n\r\n\t// Use `extract-text-webpack-plugin`\r\n\t// to extract all CSS into a separate file\r\n\t// (in production)\r\n\tif (options.development === false && options.css_bundle !== false)\r\n\t{\r\n\t\tlet css_bundle_filename = '[name]-[contenthash].css'\r\n\r\n\t\tif (typeof options.css_bundle === 'string')\r\n\t\t{\r\n\t\t\tcss_bundle_filename = options.css_bundle\r\n\t\t}\r\n\r\n\t\t// Extract styles into a file\r\n\t\t// (removing them from the code in this case).\r\n\t\t//\r\n\t\t// It moves contents of each `require(\"style.css\")`\r\n\t\t// into one big CSS file on disk\r\n\t\t// which will be later read on the server-side\r\n\t\t// and inserted into `<head><style></style></head>`.\r\n\t\t//\r\n\t\t// \"allChunks: true\" option means that the styles from all chunks\r\n\t\t// (think \"entry points\") will be extracted into a single big CSS file.\r\n\t\t//\r\n\t\tconst extract_css = extract_text_plugin_instance(css_bundle_filename, { allChunks: true })\r\n\r\n\t\t// Find module loaders with `style-loader`,\r\n\t\t// and set those module loaders to `extract-text-webpack-plugin` loader\r\n\t\tfor (let loader of find_style_loaders(configuration))\r\n\t\t{\r\n\t\t\tnormalize_loaders(loader)\r\n\r\n\t\t\tconst style_loader = loader.loaders.filter(is_style_loader)[0]\r\n\r\n\t\t\tconst style_loader_and_before = loader.loaders.slice(0, loader.loaders.indexOf(style_loader) + 1)\r\n\t\t\tconst after_style_loader      = loader.loaders.slice(loader.loaders.indexOf(style_loader) + 1)\r\n\r\n\t\t\t// The first argument to the .extract() function is the name of the loader\r\n\t\t\t// (\"style-loader\" in this case) to be applied to non-top-level-chunks in case of \"allChunks: false\" option.\r\n\t\t\t// since in this configuration \"allChunks: true\" option is used, this first argument is irrelevant.\r\n\t\t\t//\r\n\t\t\tloader.loader = extract_text_plugin_extract(extract_css, style_loader_and_before, after_style_loader)\r\n\t\t\tdelete loader.loaders\r\n\t\t}\r\n\r\n\t\t// Add the `extract-text-webpack-plugin` to the list of plugins.\r\n\t\t// It will extract all CSS into a file\r\n\t\t// (removing it from the code in this case)\r\n\t\tconfiguration.plugins.push(extract_css)\r\n\t}\r\n\r\n\t// Done\r\n\treturn configuration\r\n}\r\n\r\n// Supports both v1 and v2 of `extract-text-webpack-plugin`\r\nfunction extract_text_plugin_instance(filename, options = {})\r\n{\r\n\tlet plugin\r\n\r\n\ttry\r\n\t{\r\n\t\tplugin = new extract_text_plugin(filename, options)\r\n\t}\r\n\tcatch (error)\r\n\t{\r\n\t\tif (starts_with(error.message, 'Breaking change: ExtractTextPlugin now only takes a single argument.'))\r\n\t\t{\r\n\t\t\tplugin = new extract_text_plugin({ ...options, filename })\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthrow error\r\n\t\t}\r\n\t}\r\n\r\n\treturn plugin\r\n}\r\n\r\n// Supports both v1 and v2 of `extract-text-webpack-plugin`\r\nfunction extract_text_plugin_extract(plugin, fallbackLoader, loader, options = {})\r\n{\r\n\tlet result\r\n\r\n\ttry\r\n\t{\r\n\t\tresult = plugin.extract(fallbackLoader, loader, options)\r\n\t}\r\n\tcatch (error)\r\n\t{\r\n\t\tif (starts_with(error.message, 'Breaking change: extract now only takes a single argument.'))\r\n\t\t{\r\n\t\t\tresult = plugin.extract({ ...options, fallbackLoader, loader })\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthrow error\r\n\t\t}\r\n\t}\r\n\r\n\treturn result\r\n}\r\n"]}